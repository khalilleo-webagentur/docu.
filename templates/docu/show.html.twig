{% extends 'layout/base.html.twig' %}

{% set _itemDefined = item is defined and item %}

{% block title %} {{appName()}} :: {{catigory.name}} {{_itemDefined ? ' - ' ~ item.slug : ''}} {% endblock %}

{% block body %}

{% include 'layout/navbar.html.twig' %}

{% include 'component/custom_type_message_top_fixed.html.twig' %}

{% set _uri = app.request.uri %}

<div class="container-fluid bg-warning shadow-sm">
    <div class="container pt-3">
        <div class="row py-2 justify-content-center text-center">
            <div class="col-lg-6">
                <div class="d-block mx-auto">
                    {% include 'docu/partial/search_form.html.twig' %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid pt-3">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-6">
                <div class="ps-2">
                    <small>
                        Docu <span class="bi bi-chevron-double-right text-secondary"></span>
                        {{catigory.name}} <span class="bi bi-chevron-double-right text-secondary"></span>
                        <span class="text-secondary">{{_itemDefined ? item.slug : 'n/a'}}</span>
                    </small>

                    {% if is_granted('ROLE_SUPER_ADMIN') %}
                    <small class="float-end">
                        <a href="{{path('app_admin_docu_item_edit', {id:item.id})}}" target="_parent">
                            <span class="bi bi-pencil-square"></span>
                        </a>
                    </small>
                    {% else %}
                    <small class="bi bi-pencil-square float-end text-primary cursor-help" title="Login to Edit"></small>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container my-3">
    <div class="row pb-5">
        <div class="col-lg-3 mb-3">

            <div class="bg-white p-2 overflow-auto px-3 sticky-top shadow-sm" style="height: 71vh;">

                <br>

                {% if count(catigories) > 0 %}

                {% for row in catigories %}

                {% if count(row.items) > 0 %}
                <p class="mb-0 pt-1">
                    <b class="{{row.name == catigory.name ? 'text-dark' : 'text-secondary'}}"
                        id="{{hash(catigory.name)}}">
                        {{row.name}}
                    </b>
                </p>
                {% endif %}

                {% for item in row.items %}

                {% set _currentTab = app.request.getSchemeAndHttpHost() ~ path('app_docu_item_name',
                {slug:slug(item.slug)}) %}

                <a href="{{path('app_docu_item_name', {slug:slug(item.slug)})}}#{{hash(catigory.name)}}"
                    class="text-decoration-none {{_uri == _currentTab or item.slug == slug ? 'text-danger' : 'text-primary'}} fs-14">
                    <span class="bi bi-dot pe-1 ps-2"></span> {{item.slug}}
                </a><br>
                {% endfor %}

                {% endfor %}

                {% endif %}
            </div>

        </div>
        <div class="col-lg-6 mb-3">

            <div class="p-2 bg-white shadow-sm">

                <div class="px-lg-3">

                    {% if _itemDefined %}
                    <div class="row">
                        <div class="col">
                            <p>
                                <small class="text-secondary pe-2" title="{{item.updatedAt|date}}">
                                    Last updated: {{ timeAgo(item.updatedAt)}}
                                </small>
                            </p>
                        </div>
                        <div class="col">
                            <div class="float-end">
                                <small class="bi bi-clock small text-secondary text-warning"></small>
                                <span class="small text-secondary">{{item.readTime}}</span>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <h4>{{slug}}</h4>

                    <p class="text-secondary mb-1">{{catigory.description}}</p>

                </div>

                {% if item is defined and item %}
                <div class="p-2 px-lg-3">
                    {{item.content|raw}}
                </div>
                {% endif %}
            </div>


            <div class="row mt-4 mb-2 md-d-block">
                <div class="col-lg-12">
                    <h5>Related Articles to {{catigory.name}}</h5>
                    <ol>
                        {% for rowItem in catigory.items %}
                            {% if item.slug == rowItem.slug %}
                                <li class="text-secondary">{{item.slug}}</li>
                            {% else %}
                                <li>
                                    <a href="{{path('app_docu_item_name', {slug:slug(rowItem.slug)})}}"
                                        class="text-decoration-none fs-14 badge text-primary">
                                        {{rowItem.slug}}
                                    </a>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ol>
                </div>
            </div>

            <div class="row text-center bg-white py-4 mx-0 mt-3 shadow-sm">
                <div class="col-12">
                    <h5 class="mb-3">Was this article helpful?</h5>
                    <div class="row">
                        <div class="col-6 text-end">
                            <form action="{{path('app_docu_item_rate_store')}}" method="post">
                                <button class="btn btn-secondary btnLike px-3" type="submit"
                                    data-id="{{_itemDefined ? item.id : 0}}">
                                    <span class="bi bi-hand-thumbs-up-fill"></span> <span class="ps-2">
                                        ({{_itemDefined ? item.likes : 0}})
                                    </span>
                                </button>
                                <input type="hidden" name="id" value="{{_itemDefined ? item.id : 0}}">
                                <input type="hidden" name="like" value="on">
                                <input type="hidden" name="uri" value="{{_uri}}">
                            </form>
                        </div>
                        <div class="col-6 text-start">
                            <form action="{{path('app_docu_item_rate_store')}}" method="post">
                                <button class="btn btn-secondary btnDisLike px-3"
                                    type="submit" data-id="{{_itemDefined ? item.id : 0}}">
                                    <span class="bi bi-hand-thumbs-down-fill"></span> <span class="ps-2">
                                        ({{_itemDefined ? item.disLikes : 0}})
                                    </span>
                                </button>
                                <input type="hidden" name="id" value="{{_itemDefined ? item.id : 0}}">
                                <input type="hidden" name="disLike" value="on">
                                <input type="hidden" name="uri" value="{{_uri}}">
                            </form>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="col-lg-3">
            <div class="sticky-top">
                <div class="md-d-none py-4 bg-white px-3 shadow-sm">
                    {% for item in catigory.items %}
                    {% set _currentTab = app.request.getSchemeAndHttpHost() ~ path('app_docu_item_name',
                    {slug:slug(item.slug)}) %}
                    <div class="p-1">
                        <a href="{{path('app_docu_item_name', {slug:slug(item.slug)})}}"
                            class="text-decoration-none fs-14 {{_currentTab == _uri ? 'text-dark' : 'text-secondary'}}">
                            {{item.slug}}
                        </a>
                    </div>
                    {% endfor %}
                </div>
                <div class="my-3 bg-white shadow-sm p-3">
                    <form action="{{path('app_docu_export_item_as_pdf')}}" method="post">
                        <span class="fs-14 cursor-help text-secondary" onclick="this.closest('form').submit();" title="This feature is not implemented yet!">
                            <span class="bi bi-download pe-1"></span> Export as PDF
                        </span>
                    </form>
                </div>
                <div class="my-3 bg-white shadow-sm p-3">
                    <b class="text-secondary">Help & Support</b>
                    <p class="text-secondary small">
                        use the
                        <a href="{{path('app_contact_us_index')}}" class="text-decoration-none">
                        Contact Form</a> or send us an E-mail to <a href="mailto:{{supportEmail()}}" class="text-decoration-none">
                            {{supportEmail()}}
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'layout/footer.html.twig' %}

{% endblock %}